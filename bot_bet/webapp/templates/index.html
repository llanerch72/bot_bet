{% extends "base.html" %}

{% block title %}Pron√≥sticos diarios{% endblock %}

{% block content %}
<div class="wrap">
  <div class="topbar">
    <div>
      <div class="title">bot-bet <span class="badge b-green">LaLiga</span></div>
      <div class="muted">Pron√≥sticos diarios (guardados en SQLite) ‚Ä¢ Acceso privado</div>
    </div>

    <div class="actions" aria-label="Acciones">
      <span class="badge b-blue">üìÖ Hoy: {{ today }}</span>
    </div>
  </div>

  <div class="grid">
    <div class="card">
      <h2>Pron√≥stico de hoy</h2>

      {% if today_row %}
        <div class="muted">Guardado: {{ today_row["created_at"] }}</div>

        <form class="toolbar" method="get" action="/" aria-label="Filtros de pron√≥stico">
          <label class="sr-only" for="type">Tipo</label>
          <select id="type" name="type" aria-label="Tipo de estrella">
            <option value="all" {% if pick_type == "all" %}selected{% endif %}>Todo</option>
            <option value="goles" {% if pick_type == "goles" %}selected{% endif %}>‚≠ê Goles</option>
            <option value="tarjetas" {% if pick_type == "tarjetas" %}selected{% endif %}>‚≠ê Tarjetas</option>
          </select>

          <label class="sr-only" for="min_conf">Confianza m√≠nima</label>
          <input
            id="min_conf"
            name="min_conf"
            class="w-120"
            type="number"
            step="0.05"
            min="0"
            max="1"
            value="{{ min_conf }}"
            placeholder="0.80"
            aria-label="Confianza m√≠nima"
          />

          <button class="btn" type="submit" aria-label="Aplicar filtros">Filtrar</button>
          <a class="muted" href="/" aria-label="Reset filtros">Reset</a>
        </form>

        {% if payload and payload_matches and payload_matches|length > 0 %}
          <div class="matches">
            {% for m in payload_matches %}
              <div class="match-card">
                <div class="match-head">
                  <div class="match-title">
                    {{ m["home"] }} ‚Äì {{ m["away"] }}
                    <span class="muted">({{ m["kickoff"] }})</span>
                  </div>

                  {% set st = m["star"] %}
                  {% if st["type"] == "goles" %}
                    <span class="badge b-blue">‚≠ê Estrella (goles) ¬∑ {{ "%.2f"|format(st["confidence"]) }}</span>
                  {% else %}
                    <span class="badge b-green">‚≠ê Estrella (tarjetas) ¬∑ {{ "%.2f"|format(st["confidence"]) }}</span>
                  {% endif %}
                </div>

                <div class="row">
                  {% set g = m["picks"]["goles"] %}
                  <div class="pill">
                    <strong>‚öΩ Goles ({{ "%.2f"|format(g["confidence"]) }})</strong>
                    <span>{{ g["pick"] }}</span>
                  </div>

                  {% set c = m["picks"]["tarjetas"] %}
                  <div class="pill">
                    <strong>üü® Tarjetas ({{ "%.2f"|format(c["confidence"]) }})</strong>
                    <span>{{ c["pick"] if c["pick"] else "Sin pick" }}</span>
                  </div>

                  <div class="pill">
                    <strong>‚≠ê Estrella</strong>
                    <span>{{ st["pick"] }}</span>
                  </div>
                </div>

                <details class="details">
                  <summary class="muted">Ver desglose</summary>
                  <div class="match-body">{{ m["picks"]["goles"]["block"] }}</div>
                  <div class="match-body">{{ m["picks"]["tarjetas"]["block"] }}</div>
                </details>
              </div>
            {% endfor %}
          </div>

        {% elif text_matches and text_matches|length > 0 %}
          <div class="matches">
            {% for block in text_matches %}
              <div class="match-card">
                <div class="match-title">{{ extract_match_title(block) }}</div>
                <div class="match-body">{{ block }}</div>
              </div>
            {% endfor %}
          </div>

        {% else %}
          <p class="muted">No hay partidos (o no hay payload) para hoy.</p>
          <div class="match-body">{{ today_row["content"] }}</div>
        {% endif %}
      {% else %}
        <p class="muted">Todav√≠a no hay pron√≥stico guardado hoy.</p>
      {% endif %}
    </div>

    <div class="card">
      <h3>Hist√≥rico</h3>
      <div class="muted">√öltimos {{ days|length }} d√≠as</div>
      <ul>
        {% for d in days %}
          <li><a href="/day/{{ d }}">{{ d }}</a></li>
        {% endfor %}
      </ul>
    </div>
  </div>
</div>
{% endblock %}
